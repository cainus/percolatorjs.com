
<!DOCTYPE html>
<html lang="en" ng-app="percdocs">
  <head>
    <meta charset="utf-8">
    <title>percolator.js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/sh_acid.min.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
    <script type="text/javascript" src="/js/sh_main.min.js"></script>
    <script type="text/javascript" src="/js/sh_javascript.min.js"></script>
  </head>

  <body  onload="sh_highlightDocument();">

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/img/headr-nav.png" /></a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li class="active"><a href="about.html">About</a></li>
              <li><a href="https://github.com/cainus/percolator">Source Code</a></li>
              <li><a href="documentation.html">Documentation</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
      <div >
        <h3>
        Documentation
        </h3>
     <div>
      <h4>Hello World Quick Start:</h4>

<ul>
<li> <code>npm install Percolator</code>
</li>
<li> Create a <code>server.js</code> in your project directory, and copy this code below into it:</li>
<pre class="sh_javascript">
var Percolator = require('Percolator').Percolator;

var server = new Percolator();
server.route('/', {  GET : function($){
                              $.json({message : 'Hello World!'}).send();
                            }});
server.listen(function(err){
  console.log('server is listening on port ', server.port);
});
</pre>

</ul>
<ul>
<li>
<p>Run the server:
<code>node server.js</code>
</p>
</li>
<li><p>See your "Hello World" output at http://localhost:3000/ and be completely floored by the greatest 
API of all time.  Or not.</p>
The output json look like this:
<pre class="sh_javascript">
{
  message: "Hello World!",
  _links: {
    self: {
      href: "http://localhost:3000/"
    }
  }
}
</pre >

You'll notice that Percolator automatically adds a link to the document itself.  This is because 
it tries to help you create a surfable "Hypermedia" API where every endpoint is accessible from a link
in another endpoint, and where everything that can be done with the API is described in the API
itself.
</li>
</ul>

<div class="alert alert-success">
  <h4>Why should I care about Hypermedia??!?</h4>
  <p>
  Because Hypermedia APIs are pretty awesome for the people using your API.
  </p>
  <p>
  Developers can find their way to all your endpoints just by following the links in the json payload
  instead of having to read a bunch of docs.  Using a browser plugin like JSONView for 
  <a href="http://jsonview.com/">Firefox</a> or 
  <a href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc">chrome</a> 
  makes it so developers can just surf around your API in their browser as if your 
  responses are regular web pages.
  </p>
  <p>
  These types of APIs are machine-readable as well, so they're spider-able, and even allow automatic 
  form generation, or automated fuzz-testing.
  </p>

  <p>
  In other frameworks adding links everywhere can be time-consuming.  Percolator makes this either 
  automatic or very easy though.

  </p>
  <p>
  NOTE:  If you're worried about the size of your responses, keep in mind that 
  with proper caching and compression (gzip), there should be little to no cost to your 
  clients' performance or bandwidth.
  </p>
</div>

<h4>The Context Object ($)</h4>
The "Hello World" example should be pretty straightforward, except it has a strange dollar sign ($) in it.  
This is the context object.  The context object is basically just a holder for all the things your request 
handler will care about.  You can name it whatever you want really, but '$' is a nice short name that you're
unlikely to have a clash with in a server-side environment.  It has a number of interesting properties:

<h5>$.req</h5>
This is the unaltered <a href="http://nodejs.org/api/http.html#http_class_http_serverrequest">request object</a> from the node.js standard library.

<h5>$.res</h5>
This is the unaltered <a href="http://nodejs.org/api/http.html#http_class_http_serverrequest">response object</a> from the node.js standard library.

<h5>$.status</h5>
<p>
The status module is automatically attached to your resource handler at request time. It is just a bunch of helper functions for dealing with response statuses.
</p>

<p>
This is an important module because building great APIs requires excellent and consistent error and status reporting.
</p>

<p>
To understand what the codes mean, please refer to <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html</a>.
</p>

<h6>Usage</h6>
These methods generally set the HTTP status and end the response, so in general you should not expect to write more to the response after these. If a response body makes sense, it will generally be written automatically. For clarity, it's recommended that when you call one of these functions, you call it with return in front of it. Here's an example:

<pre class="sh_javascript">
server.route('/', {  GET : function($){
                              return $.status.redirect('/someOtherUrl');
                            }});
</pre>
<p>
Here are the functions that it makes available in your method handler:
</p>

<h6>Redirect scenarios</h6>
<dl>
  <dt>
$.status.created(redirectUrl);
  </dt>
  <dd>
This method is used for HTTP STATUS 201 scenarios when the server has just created a resource successfully so that the server can tell the client where to find it. It sets the status to 201 and sets the 'Location' header to the redirectUrl.
  </dd>
</dl>

<dl>
  <dt>
    $.status.movedPermanently(redirectUrl);
  </dt>
  <dd>
    This method is used for HTTP STATUS 301 scenarios where a resource has been permanently moved somewhere else so the server can tell the client where to find it. It sets the status to 301 and sets the 'Location' header to the redirectUrl.
  </dd>
</dl>

<dl>
  <dt>
    $.status.redirect(redirectUrl);
  </dt>
  <dd>
    This is just an alias of movedPermanently()
  </dd>
</dl>

<h6>Error Scenarios</h6>
All of the error scenarios are handled similarly and attempt to show a response body that indicates the error that occurred as well. The status code will be set on the response as well as in that response body.

All of these methods additionally take a single parameter where additional detail information can be added. For example:

<pre class="sh_javascript">
server.route('/', {  GET : function($){
                              return $.status.internalServerError('The server is on fire.');
                            }});
</pre>

Output for application/json:
<code>
{"type":500,"message":"Internal Server Error","detail":"The server is on fire"}
</code>
<h6>Error response methods (with example response for application/json):</h6>
<code>
</code>

<dl>
  <dt>
    $.status.badRequest([detail])
  </dt>
  <dd>
    <code>
    {"type":400,"message":"Bad Request"}
    </code>
  </dd>
</dl>


<dl>
  <dt>
    $.status.unauthenticated([detail])
  </dt>
  <dd>
    <code>
      {"type":401,"message":"Unauthenticated"}
    </code>
  </dd>
</dl>

<dl>
  <dt>
      $.status.forbidden([detail])
  </dt>
  <dd>
    <code>
      {"type":403,"message":"Forbidden"}
    </code>
  </dd>
</dl>


<dl>
  <dt>
      $.status.notFound([detail])
  </dt>
  <dd>
    <code>
{"type":404,"message":"Not Found"}
    </code>
  </dd>
</dl>

<dl>
  <dt>
      $.status.methodNotAllowed([detail])
  </dt>
  <dd>
    <code>
{"type":405,"message":"Method Not Allowed"}
    </code>
  </dd>
</dl>

<dl>
  <dt>
      $.status.notAcceptable([detail])
  </dt>
  <dd>
    <code>
      {"type":406,"message":"Not Acceptable"}
    </code>
  </dd>
</dl>


<dl>
  <dt>
      $.status.conflict([detail])
  </dt>
  <dd>
    <code>
        {"type":409,"message":"Conflict"}
    </code>
  </dd>
</dl>

<dl>
  <dt>
      $.status.gone([detail])
  </dt>
  <dd>
    <code>
        {"type":410,"message":"Gone"}
    </code>
  </dd>
</dl>

<dl>
  <dt>
      $.status.lengthRequired([detail])
  </dt>
  <dd>
    <code>
        {"type":411,"message":"Length Required"}
    </code>
  </dd>
</dl>

<dl>
  <dt>
      $.status.preconditionFailed([detail])
  </dt>
  <dd>
    <code>
        {"type":412,"message":"Precondition Failed"}
    </code>
  </dd>
</dl>


<dl>
  <dt>
      $.status.requestEntityTooLarge([detail])
  </dt>
  <dd>
    <code>
        {"type":413,"message":"'Request Entity Too Large"}
    </code>
  </dd>
</dl>



<dl>
  <dt>
      $.status.requestEntityTooLarge([detail])
  </dt>
  <dd>
    <code>
        {"type":413,"message":"'Request Entity Too Large"}
    </code>
  </dd>
</dl>




<dl>
  <dt>
$.status.requestUriTooLong([detail])
  </dt>
  <dd>
    <code>
{"type":414,"message":"Request URI Too Long"}
    </code>
  </dd>
</dl>



<dl>
  <dt>
$.status.unsupportedMediaType([detail])
  </dt>
  <dd>
    <code>
{"type":415,"message":"Unsupported Media Type"}
    </code>
  </dd>
</dl>



<dl>
  <dt>
$.status.unprocessableEntity([detail])
  </dt>
  <dd>
    <code>
{"type":422,"message":"'Unprocessable Entity"}
    </code>
  </dd>
</dl>



<dl>
  <dt>
$.status.tooManyRequests([detail])
  </dt>
  <dd>
    <code>
{"type":429,"message":"Too Many Requests"}
    </code>
  </dd>
</dl>



<dl>
  <dt>
$.status.internalServerError([detail])
  </dt>
  <dd>
    <code>
{"type":500,"message":"Internal Server Error"}
    </code>
  </dd>
</dl>



<dl>
  <dt>
$.status.notImplemented([detail])
  </dt>
  <dd>
    <code>
{"type":501,"message":"Not Implemented"}
    </code>
  </dd>
</dl>



<dl>
  <dt>
$.status.badGateway([detail])
  </dt>
  <dd>
    <code>
{"type":502,"message":"Bad Gateway"}
    </code>
  </dd>
</dl>



<dl>
  <dt>
      $.status.serviceUnavailable([detail])
  </dt>
  <dd>
    <code>
        {"type":503,"message":"Service Unavailable"}
    </code>
  </dd>
</dl>



<dl>
  <dt>
      $.status.gatewayTimeout([detail])
  </dt>
  <dd>
    <code>
        {"type":504,"message":"Gateway Timeout"}
    </code>
  </dd>
</dl>



<!--
<h4>Hello World Refactored:</h4>

<p>While this is pretty simple, it's also not super-interesting.  One of the interesting features of 
Percolator is that it lets you load your route-handling code from external files instead:</p>

<ul>
<li>Move your "Hello World" handler into a file at the path <code>./resources/index.js</code> by first creating the 
<code>resources</code> directory and then the <code>index.js</code> file in it and then copying the handler logic into <code>index.js</code>
like so:</li>
</ul>
<pre class="sh_javascript">
exports.handler = {
  GET : function(req, res){
    res.end('Hello World!');
  }
}
</pre>
We'll call files like that "resources" from now on.

<ul>
<li>Change your server.js to call <code>routeDirectory()</code> instead of <code>server.router.route()</code> like so:</li>
</ul>

<pre class="sh_javascript">
var Percolator = require('Percolator');

var server = new Percolator();
server.routeDirectory(__dirname + '/resources', function(err){
  if (!!err) {console.log(err);}
  server.listen(function(err){
    console.log('server is listening on port ', server.port);
  });
});
</pre>

<ul>
<li>
<p>Run the server:
<code>node server.js</code>
</p>
</li>
<li><p>See your "Hello World" output at http://localhost:3000/ .</p></li>
</ul>
    </div>
    -->


    <!--  END DOCS --> 
      </div>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="js/bootstrap-transition.js"></script>
    <script src="js/bootstrap-alert.js"></script>
    <script src="js/bootstrap-modal.js"></script>
    <script src="js/bootstrap-dropdown.js"></script>
    <script src="js/bootstrap-scrollspy.js"></script>
    <script src="js/bootstrap-tab.js"></script>
    <script src="js/bootstrap-tooltip.js"></script>
    <script src="js/bootstrap-popover.js"></script>
    <script src="js/bootstrap-button.js"></script>
    <script src="js/bootstrap-collapse.js"></script>
    <script src="js/bootstrap-carousel.js"></script>
    <script src="js/bootstrap-typeahead.js"></script>
    <script src="js/bootstrap-affix.js"></script>
    

  </body>
</html>


